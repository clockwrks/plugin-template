var i=require("@enmity/patcher"),S=require("@enmity/metro");const p="1388444223610556589",P="378986339007201290",v=" [LOCAL SPOOF]",A=2e3;let m=null,y=!1;var I={onStart(){console.log("[Imposter(local)] starting");const o=S.findByProps("getUser","getCurrentUser"),s=S.findByProps("getUserProfile","getMutualGuilds"),d=S.findByProps("getPrimaryActivity","getActivitiesForUser"),b=S.findByProps("getMember","getMembers");if(!o){console.warn("[Imposter(local)] UserStore not found \u2014 plugin cannot run");return}const u=()=>{const r=o.getUser(String(p)),e=o.getUser(String(P));return!r||!e?(console.log("[Imposter(local)] waiting for cache. subjectCached:",!!r," targetCached:",!!e),!1):(y||(M(o,s,d,b),y=!0,console.log("[Imposter(local)] patches applied \u2014 subject:",r.username," target:",e.username)),!0)};u()||(m=setInterval(()=>{u()&&m&&(clearInterval(m),m=null)},A),console.log("[Imposter(local)] plugin will apply when both users appear in cache. Open their profiles or view their messages."))},onStop(){try{i.Patcher.unpatchAll("imposter"),i.Patcher.unpatchAll("imposter:user-getUser"),i.Patcher.unpatchAll("imposter:userprofile-getUserProfile"),i.Patcher.unpatchAll("imposter:userprofile-getMutualGuilds"),i.Patcher.unpatchAll("imposter:presence-getPrimaryActivity"),i.Patcher.unpatchAll("imposter:guildmember-getMember")}catch{}m&&(clearInterval(m),m=null),y=!1,console.log("[Imposter(local)] stopped and unpatched")}};function M(o,s,d,b){i.Patcher.after("imposter:user-getUser",o,"getUser",(u,r,e)=>{var n,g,c;if(!e)return e;const a=r&&r[0];if(String(a||e.id)!==String(P))return e;const t=o.getUser(String(p));if(!t)return e;const l={...e};return l.username=((n=t.username)!=null?n:e.username)+v,l.avatar=(g=t.avatar)!=null?g:e.avatar,l.banner=(c=t.banner)!=null?c:e.banner,l.globalName=t.globalName?t.globalName+v:e.globalName,l}),s&&(i.Patcher.after("imposter:userprofile-getUserProfile",s,"getUserProfile",(u,r,e)=>{var n,g,c,a,t,l;if(!e)return e;const U=r&&r[0];if(String(U)!==String(P))return e;const f=s.getUserProfile(String(p));if(!f)return e;const h={...e};return h.badges=(n=f.badges)!=null?n:e.badges,h.bio=((c=(g=f.bio)!=null?g:e.bio)!=null?c:"")+v,h.profileEffectId=(a=f.profileEffectId)!=null?a:e.profileEffectId,h.pronouns=(t=f.pronouns)!=null?t:e.pronouns,h.themeColor=(l=f.themeColor)!=null?l:e.themeColor,h}),i.Patcher.after("imposter:userprofile-getMutualGuilds",s,"getMutualGuilds",(u,r,e)=>{if(!r)return e;const n=r[0];return String(n)!==String(P)?e:s.getMutualGuilds(String(p))||e})),d&&i.Patcher.after("imposter:presence-getPrimaryActivity",d,"getPrimaryActivity",(u,r,e)=>{if(!r)return e;const n=r[0];return String(n)!==String(P)?e:d.getPrimaryActivity(String(p))||e}),b&&i.Patcher.after("imposter:guildmember-getMember",b,"getMember",(u,r,e)=>{var n;if(!r)return e;const g=r[0],c=r[1];if(String(c)!==String(P))return e;const a=b.getMember(g,String(p)),t=o.getUser(String(p));if(!t)return e;const l={...e};return l.nick=(a&&a.nick?a.nick:(n=t.globalName)!=null?n:t.username)+v,l})}module.exports=I;
